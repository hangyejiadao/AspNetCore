@{
    ViewBag.Title = "BhzSysIndex1";
    Layout = "~/Views/BasePage/_LayoutMsSysList.cshtml";
}

<div id="toolBarMain" class="list-toolbar">

    <div class="row">

        <a href="javascript:;" class="easyui-linkbutton" id="lbtnAdd" data-options="iconCls:'fa fa-plus-circle',plain:true">添加</a>
        <a href="javascript:;" class="easyui-linkbutton" id="lbtnModify" data-options="iconCls:'fa fa-edit',plain:true">修改</a>
        <a href="javascript:;" class="easyui-linkbutton" id="lbtnDelete" data-options="iconCls:'fa fa-times-circle',plain:true">删除</a>
        <a href="javascript:;" class="easyui-linkbutton" id="lbtnSearch" data-options="iconCls:'fa fa-search-plus',plain:true">查询</a>

    </div>

</div>

<script type="text/javascript">

    var gridObj, gdKeyId = 'TargetId';

    var paramsData = {
        "LoadApi": '@ViewBag.LoadApi'
    }

    function ModuleQuery(data) {
        //alert("查询数据" + JSON.stringify(data));
        paramsData.LoadApi = 1;
        queryData();
    }

    //查询数据
    function queryData() {
        QBO.plu.grid.query(gridObj, paramsData, 'tg');
    }

</script>

<script type="text/javascript">

    $(function () {
        var idxData = parent.idxData;
        if (idxData.idx_mod1 == 5 && idxData.idx_mod2 == 7) {
            paramsData.LoadApi = 1;
        } else {
            paramsData.LoadApi = 0;
        }

        initData();
        initEvent();
    });

    function initData() {
        gridObj = $('#dg');

        QBO.plu.grid.init(gridObj, {
            keyId: gdKeyId,
            queryParams: paramsData,
            method: "GET",
            url: '/MsSys/BhzSys/GetProLabList',
            idField: gdKeyId,
            treeField: 'TargetName',
            animate: true,
            pagination: false,
            col: [
                { field: gdKeyId, checkbox: true },
                { field: 'TargetName', title: '标段名称', align: 'left', width: 200 },
                { field: 'FullName', title: '标段全称', align: 'left', width: 300 },
                { field: 'OrderNum', title: '排序', width: 150 }
            ],
            toolbar: 'toolBarMain',
            onLoadSuccess: function () {

            }
        }, 'tg');
    }

    function initEvent() {
        $('#lbtnSearch').linkbutton({ onClick: function () { doHanlder('search'); } });
        $('#lbtnAdd').linkbutton({ onClick: function () { doHanlder('add'); } });
        $('#lbtnModify').linkbutton({ onClick: function () { doHanlder('modify'); } });
        $('#lbtnDelete').linkbutton({ onClick: function () { doHanlder('delete'); } });
    }


    function doHanlder(type) {
        switch (type) {
            case 'search':
                queryData();
                break;
            case 'add':
                var url = "/MsSys/BhzSys/BhzSysDetail8?KeyId=";
                QBO.frm.openWin(url, { title: '添加', icon: 'tasks', width: 600, height: 350 });
                break;
            case 'modify':
                var selData = QBO.plu.grid.get(gridObj, gdKeyId);
                if (selData.obj.length <= 0) {
                    QBO.dia.msg('请勾选需要修改的数据！', { shift: 6, icon: 'error', time: 2000 });
                    return;
                }
                var keyId = selData.str;
                url = "/MsSys/BhzSys/BhzSysDetail8?KeyId=" + keyId ;
                QBO.frm.openWin(url, { title: '修改', icon: 'tasks', width: 600, height: 350 });
                break;
            case 'delete':
                var selData = QBO.plu.grid.get(gridObj, gdKeyId);
                //console.log(JSON.stringify(selData))
                if (selData.obj.length <= 0) {
                    QBO.dia.msg('请勾选需要删除的数据！', { shift: 6, icon: 'error', time: 2000 });
                    return;
                }
                deleteData(selData.str);
                break;
        }
    }


    //删除数据
    function deleteData(Id) {
        QBO.plu.ajax({
            type: 'GET',
            doType: '删除',
            url: '/MsSys/BhzSys/DelProLabByID',
            data: { Id: Id }
        }, function (data) {
            //定义提示信息和图标
            var retTip = data.Result === 100 ? '删除成功！' : '删除失败，请稍后再试！',
                retIcon = data.Result === 100 ? 'right' : 'error';

            QBO.dia.msg(retTip, {
                icon: retIcon,
                endCallback: function () {
                    if (data.Result === 100) {
                        queryData();
                    }
                }
            });
        });
    }

</script>





